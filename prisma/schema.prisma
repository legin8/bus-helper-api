// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  userId          Int           @id @default(autoincrement())
  email           String        @unique
  name            String
  password        String
  role            String
  createdAt       DateTime      @default(now())
}

model Agency {
  code          String    @id @unique
  region        String
  url           String
  phone         String
  routes        Route[]
}

model Route {
  title           String
  agencyCode      String
  locations       String
  isSchoolRun     Boolean   @default(false)
  agency          Agency    @relation(fields: [agencyCode], references: [code])
  services        Service[]
  @@id([title, agencyCode, isSchoolRun])
}

model Service {
  code            String
  agencyCode      String
  isSchoolRun     Boolean   @default(false)
  routeTitle      String
  name            String
  route           Route     @relation(fields: [routeTitle, agencyCode, isSchoolRun], references: [title, agencyCode, isSchoolRun])
  trips           Trip[]
  @@id([code, agencyCode])
}

model Trip {
  serviceCode     String
  code            Int
  agencyCode      String
  name            String
  service         Service @relation(fields: [serviceCode, agencyCode], references: [code, agencyCode])

  @@id([serviceCode, code, agencyCode])
}

model TripRun {
  tripCode              Int @id
  runCode               Int
}

model Run {
  code             String
  version          Int
  order            Int
  timeIncrement    Int
  runStop          RunStop[]
  @@id([code, version, order])
}

model RunStop {
  runCode         String
  version         Int
  order           Int
  stopCode        String
  run             Run      @relation(fields: [runCode, version, order], references: [code, version, order])
  stop            Stop     @relation(fields: [stopCode], references: [code])
  @@id([runCode, stopCode])
}

model Stop {
  code            String  @id
  name            String
  long            String
  lat             String
  runStop        RunStop[]
}

// enum Role {
//   ADMIN_USER
//   BASIC_USER
// }